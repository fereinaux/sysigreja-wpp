# WhatsApp Gateway Service

Serviço de gateway WhatsApp usando Baileys (WhiskeySockets) com armazenamento de sessões no Redis.

## Características

- ✅ Gerencia múltiplas sessões WhatsApp simultâneas
- ✅ Envia mensagens (texto, imagem, áudio)
- ✅ Modo envio somente (não processa mensagens recebidas)
- ✅ Armazenamento de sessões no Redis
- ✅ Integração com MinIO para mídias
- ✅ REST API completa

## Pré-requisitos

- Node.js 18+
- Redis
- MinIO (opcional, apenas para envio de mídias)

## Instalação

```bash
npm install
```

## Configuração

Copie o arquivo `.env.example` para `.env` e configure as variáveis:

```bash
cp .env.example .env
```

## Desenvolvimento

```bash
npm run dev
```

## Build

```bash
npm run build
npm start
```

## Endpoints da API

### POST `/sessions/:userId/create`

Cria uma nova sessão e retorna QR Code.

### GET `/sessions/:userId/status`

Obtém o status da sessão.

### GET `/sessions/:userId/qr`

Obtém o QR Code pendente.

### POST `/send-text`

Envia mensagem de texto.

### POST `/send-image`

Envia imagem com legenda.

### POST `/send-audio`

Envia áudio.

### DELETE `/sessions/:userId`

Remove uma sessão.

### GET `/health`

Health check do serviço.

## Docker

```bash
docker build -t whatsapp-gateway .
docker run -p 3001:3001 --env-file .env whatsapp-gateway
```

## Integração com Backend

Para saber como integrar este gateway com seu backend (NestJS ou outro), consulte a [Documentação de Integração](./API_INTEGRATION.md).

A documentação inclui:

- Todos os endpoints disponíveis
- Exemplos de código em TypeScript/JavaScript
- Exemplo completo de serviço NestJS
- Tratamento de erros
- Boas práticas
- Fluxo completo de uso

## Troubleshooting

### Erro 405 (Connection Failure)

Se você estiver enfrentando o erro **405 (Connection Failure)** ao tentar criar sessões, consulte o guia completo: [TROUBLESHOOTING_405.md](./TROUBLESHOOTING_405.md)

**Resumo:** O erro 405 geralmente ocorre quando o WhatsApp bloqueia conexões. Mesmo em ambiente local, pode ser causado por:
- ISP bloqueando conexões
- Windows Defender/Antivírus bloqueando WebSocket
- Configuração de browser inadequada
- Rate limiting do WhatsApp

**Teste diferentes configurações de browser:**
```bash
npm run test:browsers
```

Este script testa várias configurações de browser para identificar qual funciona no seu ambiente.
